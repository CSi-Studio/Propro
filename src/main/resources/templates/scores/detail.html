<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="/layouts/layout">
<!-- begin::Head -->
<head>
    <title>
        欢迎登陆西湖大学PECS分析平台
    </title>

    <link th:href="|${url}/assets/css/pagination.css|" rel="stylesheet" type="text/css"/>

</head>
<!-- end::Head -->
<!-- end::Body -->
<body>

<div class="m-subheader ">
    <div class="d-flex align-items-center">
        <div class="mr-auto">
            <h3 class="m-subheader__title m-subheader__title--separator">
                子分数分布情况
            </h3>
        </div>
    </div>
</div>

<div class="m-content" layout:fragment="content">

    <div class="alert alert-danger" role="alert" th:if="${error_msg}" th:text="${error_msg}"></div>
    <div th:if="${errorList}" th:each="arrayS:${errorList}">
        <div class="alert alert-danger" role="alert" th:text="${arrayS}"></div>
    </div>

    <div class="alert alert-success" role="alert" th:if="${success_msg}" th:text="${success_msg}"></div>
    <div class="row">
        <div class="col-md-12 alert alert-success" role="alert" th:text="|${overview.expName}---${overview.expName}(${overview.expId})---${overview.libraryName}(${overview.libraryId})---overviewId:${overview.id}|"></div>
    </div>
    <div class="row">
        <div class="col-md-3" style="width: 25%;height:300px;" th:each="scoreType:${scoreTypes}" th:id="${scoreType.typeName}" th:text="${scoreType.typeName}"></div>
    </div>

</div>


</body>

<th:block layout:fragment="script">
    <script th:src="|${url}/assets/js/echarts/echarts.min.js|" type="text/javascript"></script>
    <script th:src="|${url}/assets/js/echarts/dark.js|" type="text/javascript"></script>

    <script th:inline="javascript">

        /*<![CDATA[*/
        var scoreTypes = [[${scoreTypes}]];
        var overviewId = [[${overview.id}]];
        /*]]>*/

        var chartMap = {};

        $(document).ready(function () {
            for(i in scoreTypes){
                var element = echarts.init(document.getElementById(scoreTypes[i]));
                if(element){
                    chartMap[scoreTypes[i]] = element;
                }
            }
            query();
        });

        function query() {
            var distributions = null;
            $.ajax({
                type: "POST",
                url: "/scores/distributions",
                data: {
                    overviewId: overviewId
                },
                dataType: "json",
                async: false,
                success: function (result) {
                    if (result.success) {
                        distributions = result.model;
                    } else {
                        for(chart in charts){
                            chart.clear();
                        }
                    }
                }
            });

            if (distributions == null) {
                return;
            }

            for(i in distributions){
                var chart = chartMap[distributions[i].scoreType];
                if(chart == null){
                    continue;
                }
                var count_series = [];
                count_series.push({name: "target", type: 'line', smooth: true, data: distributions[i].targetCount});
                count_series.push({name: "decoy", type: 'line', smooth: true, data: distributions[i].decoyCount});

                option = {
                    title: {
                        text: distributions[i].scoreType,
                        left: 10
                    },
                    legend: {
                        data: ['range/count'],
                        align: 'left'
                    },
                    toolbox: {
                        // y: 'bottom',
                        feature: {
                            dataView: {},
                            saveAsImage: {
                                pixelRatio: 2
                            }

                        }
                    },
                    // dataZoom: [{
                    //     type: 'inside',
                    //     filterMode: 'empty'
                    // }, {
                    //     type: 'slider'
                    // }],
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                            type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                        }
                    },
                    xAxis: {
                        data: distributions[i].ranges,
                        silent: false,
                        splitLine: {
                            show: false
                        }
                    },
                    yAxis: {},
                    series: count_series
                };

                chart.setOption(option, true);
            }
        }
    </script>
</th:block>

<!-- end::Body -->
</html>
